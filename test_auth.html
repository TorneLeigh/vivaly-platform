<!DOCTYPE html>
<html>
<head>
    <title>Test Auth</title>
</head>
<body>
    <h1>Test Authentication</h1>
    
    <div id="login-section">
        <h2>Login</h2>
        <form id="login-form">
            <input type="email" id="email" placeholder="Email" value="tornevelk1@gmail.com">
            <input type="password" id="password" placeholder="Password" value="your_password">
            <select id="role">
                <option value="parent">Parent</option>
                <option value="caregiver">Caregiver</option>
            </select>
            <button type="submit">Login</button>
        </form>
    </div>
    
    <div id="user-info" style="display:none;">
        <h2>User Info</h2>
        <pre id="user-data"></pre>
        <button onclick="checkAuth()">Check Auth</button>
        <button onclick="switchRole('parent')">Switch to Parent</button>
        <button onclick="switchRole('caregiver')">Switch to Caregiver</button>
        <button onclick="logout()">Logout</button>
    </div>

    <script>
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;
            
            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password, role }),
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Login success:', data);
                    showUserInfo();
                    checkAuth();
                } else {
                    const error = await response.json();
                    alert('Login failed: ' + error.message);
                }
            } catch (err) {
                alert('Login error: ' + err.message);
            }
        });
        
        async function checkAuth() {
            try {
                const response = await fetch('/api/auth/user', {
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('user-data').textContent = JSON.stringify(data, null, 2);
                    console.log('Auth check:', data);
                } else {
                    console.log('Not authenticated');
                    showLogin();
                }
            } catch (err) {
                console.error('Auth check error:', err);
            }
        }
        
        async function switchRole(role) {
            try {
                const response = await fetch('/api/auth/switch-role', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ role }),
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Role switched:', data);
                    checkAuth();
                } else {
                    const error = await response.json();
                    alert('Role switch failed: ' + error.message);
                }
            } catch (err) {
                alert('Role switch error: ' + err.message);
            }
        }
        
        async function logout() {
            try {
                await fetch('/api/auth/logout', {
                    method: 'POST',
                    credentials: 'include'
                });
                showLogin();
            } catch (err) {
                console.error('Logout error:', err);
            }
        }
        
        function showLogin() {
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('user-info').style.display = 'none';
        }
        
        function showUserInfo() {
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('user-info').style.display = 'block';
        }
        
        // Check auth on page load
        checkAuth();
    </script>
</body>
</html>